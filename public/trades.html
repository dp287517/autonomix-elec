<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutonomiX - Trade Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            z-index: -1;
        }
        .star {
            position: absolute;
            background: #ffffff;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        .floating-logo {
            position: absolute;
            animation: float 20s linear infinite;
            opacity: 0.5;
        }
        @keyframes float {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100px); }
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: #60a5fa;
            color: #0a0a0a;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: #3b82f6;
            transform: scale(1.05);
        }
        .btn-danger {
            background: #4b5563;
            color: #ffffff;
        }
        .btn-danger:hover {
            background: #374151;
            transform: scale(1.05);
        }
        .btn-analyze {
            background: #a855f7;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        .btn-analyze:hover {
            background: #9333ea;
            transform: scale(1.05);
        }
        canvas {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .progress-bar {
            background: linear-gradient(90deg, #60a5fa 0%, #a855f7 100%);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: #ffffff;
            height: 100%;
            transition: width 1s ease;
        }
        .loading-spinner {
            border: 4px solid #ffffff;
            border-top: 4px solid #60a5fa;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .supernova {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(96, 165, 250, 0.5) 0%, rgba(0, 0, 0, 0) 70%);
            animation: supernova 2s ease-out forwards;
            z-index: 10;
            pointer-events: none;
        }
        @keyframes supernova {
            0% { opacity: 1; transform: scale(0.1); }
            100% { opacity: 0; transform: scale(2); }
        }
        .crypto-logo {
            width: 32px;
            height: 32px;
            vertical-align: middle;
            margin-right: 8px;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="starfield">
        <script>
            // Étoiles
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                document.querySelector('.starfield').appendChild(star);
            }
        </script>
    </div>
    <div class="container mx-auto p-6">
        <h1 class="text-5xl font-extrabold mb-8 text-center">AutonomiX - De 10$ à 1M$</h1>

        <!-- Prix en Temps Réel -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Prix en Temps Réel</h2>
            <div id="livePrices" class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
        </div>

        <!-- Analyse Crypto -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Analyse Crypto</h2>
            <button id="analyzeButton" class="btn-analyze p-3 rounded-lg font-semibold flex items-center">
                <span>Lancer Analyse Crypto</span>
                <div id="loadingSpinner" class="loading-spinner ml-2"></div>
            </button>
            <div id="signalResult" class="mt-4 hidden">
                <h3 class="text-xl font-semibold mb-2">Meilleur Trade Recommandé</h3>
                <p><strong>Actif :</strong> <img id="signalLogo" class="crypto-logo" src="" alt="Crypto Logo"> <span id="signalPair"></span></p>
                <p><strong>Signal :</strong> <span id="signalType"></span></p>
                <p><strong>Prix d'entrée :</strong> <span id="signalPrice"></span> USD</p>
                <p><strong>Cible :</strong> <span id="signalTarget"></span> USD</p>
                <p><strong>Stop-loss :</strong> <span id="signalStopLoss"></span> USD</p>
                <p><strong>RSI (1h) :</strong> <span id="signalRsi"></span></p>
                <p><strong>Volatilité (ATR) :</strong> <span id="signalAtr"></span></p>
                <p><strong>Support (1d) :</strong> <span id="signalSupport"></span></p>
                <p><strong>Résistance (1d) :</strong> <span id="signalResistance"></span></p>
                <p><strong>Confiance :</strong> <span id="signalConfidence"></span></p>
                <p><strong>Score :</strong> <span id="signalScore"></span>/100</p>
                <p><strong>Raison :</strong> <span id="signalReason"></span></p>
                <canvas id="signalChart" height="200" class="mt-4"></canvas>
            </div>
        </div>

        <!-- Analyse d’un trade soumis -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Analyser Mon Trade</h2>
            <form id="tradeAnalysisForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <select id="tradePair" class="border p-3 rounded-lg bg-gray-900 text-white" required>
                    <option value="">Sélectionner une paire</option>
                    <option value="BTC/USD">BTC/USD</option>
                    <option value="ETH/USD">ETH/USD</option>
                    <option value="XRP/USD">XRP/USD</option>
                    <option value="SOL/USD">SOL/USD</option>
                    <option value="DOGE/USD">DOGE/USD</option>
                    <option value="ADA/USD">ADA/USD</option>
                    <option value="SUI/USD">SUI/USD</option>
                    <option value="AAVE/USD">AAVE/USD</option>
                    <option value="LINK/USD">LINK/USD</option>
                    <option value="AVAX/USD">AVAX/USD</option>
                    <option value="NEAR/USD">NEAR/USD</option>
                    <option value="XLM/USD">XLM/USD</option>
                    <option value="LTC/USD">LTC/USD</option>
                    <option value="DOT/USD">DOT/USD</option>
                    <option value="MATIC/USD">MATIC/USD</option>
                    <option value="SHIB/USD">SHIB/USD</option>
                    <option value="UNI/USD">UNI/USD</option>
                    <option value="TRX/USD">TRX/USD</option>
                    <option value="BCH/USD">BCH/USD</option>
                    <option value="EOS/USD">EOS/USD</option>
                    <option value="ALGO/USD">ALGO/USD</option>
                    <option value="ATOM/USD">ATOM/USD</option>
                    <option value="FIL/USD">FIL/USD</option>
                    <option value="ICP/USD">ICP/USD</option>
                    <option value="HBAR/USD">HBAR/USD</option>
                    <option value="ETC/USD">ETC/USD</option>
                    <option value="XMR/USD">XMR/USD</option>
                    <option value="APT/USD">APT/USD</option>
                    <option value="RNDR/USD">RNDR/USD</option>
                    <option value="STX/USD">STX/USD</option>
                    <option value="IMX/USD">IMX/USD</option>
                    <option value="AR/USD">AR/USD</option>
                    <option value="GRT/USD">GRT/USD</option>
                    <option value="MKR/USD">MKR/USD</option>
                    <option value="PEPE/USD">PEPE/USD</option>
                    <option value="LDO/USD">LDO/USD</option>
                    <option value="QNT/USD">QNT/USD</option>
                    <option value="FET/USD">FET/USD</option>
                    <option value="SAND/USD">SAND/USD</option>
                    <option value="MANA/USD">MANA/USD</option>
                    <option value="AXS/USD">AXS/USD</option>
                    <option value="GALA/USD">GALA/USD</option>
                    <option value="CHZ/USD">CHZ/USD</option>
                    <option value="CRV/USD">CRV/USD</option>
                    <option value="SNX/USD">SNX/USD</option>
                    <option value="COMP/USD">COMP/USD</option>
                    <option value="1INCH/USD">1INCH/USD</option>
                    <option value="ZRX/USD">ZRX/USD</option>
                    <option value="BAT/USD">BAT/USD</option>
                    <option value="ENJ/USD">ENJ/USD</option>
                    <option value="YFI/USD">YFI/USD</option>
                    <option value="BAL/USD">BAL/USD</option>
                    <option value="KSM/USD">KSM/USD</option>
                    <option value="GLM/USD">GLM/USD</option>
                    <option value="OCEAN/USD">OCEAN/USD</option>
                    <option value="POWR/USD">POWR/USD</option>
                    <option value="STORJ/USD">STORJ/USD</option>
                    <option value="ZEC/USD">ZEC/USD</option>
                    <option value="DASH/USD">DASH/USD</option>
                    <option value="XTZ/USD">XTZ/USD</option>
                    <option value="WAVES/USD">WAVES/USD</option>
                    <option value="OMG/USD">OMG/USD</option>
                    <option value="KNC/USD">KNC/USD</option>
                    <option value="REP/USD">REP/USD</option>
                    <option value="PAXG/USD">PAXG/USD</option>
                    <option value="TBTC/USD">TBTC/USD</option>
                    <option value="USDT/USD">USDT/USD</option>
                    <option value="USDC/USD">USDC/USD</option>
                    <option value="DAI/USD">DAI/USD</option>
                </select>
                <input type="number" id="entryPrice" placeholder="Prix d'entrée ($)" class="border p-3 rounded-lg bg-gray-900 text-white" step="0.01" required>
                <select id="tradeSignalType" class="border p-3 rounded-lg bg-gray-900 text-white" required>
                    <option value="ACHAT">Achat</option>
                    <option value="VENTE">Vente</option>
                </select>
                <button type="submit" class="btn-analyze p-3 rounded-lg col-span-1 md:col-span-3 font-semibold flex items-center">
                    <span>Analyser Trade</span>
                    <div id="tradeAnalysisSpinner" class="loading-spinner ml-2"></div>
                </button>
            </form>
            <div id="tradeAnalysisResult" class="mt-4 hidden">
                <h3 class="text-xl font-semibold mb-2">Analyse de Votre Trade</h3>
                <p><strong>Recommandation :</strong> <span id="tradeRecommendation"></span></p>
                <p><strong>Raison :</strong> <span id="tradeReason"></span></p>
                <p><strong>Score :</strong> <span id="tradeScore"></span>/100</p>
                <p><strong>Prix actuel :</strong> <span id="tradeCurrentPrice"></span> USD</p>
                <p><strong>Support (1d) :</strong> <span id="tradeSupport"></span></p>
                <p><strong>Résistance (1d) :</strong> <span id="tradeResistance"></span></p>
                <p><strong>RSI (1h) :</strong> <span id="tradeRsi"></span></p>
                <p><strong>Volatilité (ATR) :</strong> <span id="tradeAtr"></span></p>
                <canvas id="tradeAnalysisChart" height="200" class="mt-4"></canvas>
            </div>
        </div>

        <!-- Progression vers 1M$ -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Trajectoire vers 1M$</h2>
            <p class="text-sm text-gray-300 mb-2">Progression vers votre objectif</p>
            <div class="progress-bar">
                <div id="progressBarFill" class="progress-bar-fill" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-sm text-gray-300 mt-2">0% complété</p>
            <p id="forecastText" class="text-sm text-gray-300 mt-2">Estimation : -</p>
        </div>

        <!-- Formulaire pour ajouter un trade -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Ajouter un Trade</h2>
            <form id="tradeForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="date" id="trade_date" class="border p-3 rounded-lg bg-gray-900 text-white" required>
                <input type="number" id="investment" placeholder="Investissement ($)" class="border p-3 rounded-lg bg-gray-900 text-white" step="0.01" required>
                <input type="number" id="profit_loss" placeholder="Gain/Perte ($)" class="border p-3 rounded-lg bg-gray-900 text-white" step="0.01" required>
                <input type="number" id="current_capital" placeholder="Capital Actuel ($)" class="border p-3 rounded-lg bg-gray-900 text-white" step="0.01" required>
                <input type="text" id="notes" placeholder="Notes" class="border p-3 rounded-lg bg-gray-900 text-white">
                <button type="submit" class="btn-primary p-3 rounded-lg col-span-1 md:col-span-3 font-semibold">Ajouter Trade</button>
            </form>
        </div>

        <!-- Statistiques -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Statistiques Cosmiques</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="p-4 bg-gray-800 rounded-lg">
                    <p class="text-sm text-gray-300">Nombre de Trades</p>
                    <p id="totalTrades" class="text-2xl font-bold">0</p>
                </div>
                <div class="p-4 bg-gray-800 rounded-lg">
                    <p class="text-sm text-gray-300">Gain Total ($)</p>
                    <p id="totalProfit" class="text-2xl font-bold">0</p>
                </div>
                <div class="p-4 bg-gray-800 rounded-lg">
                    <p class="text-sm text-gray-300">Perte Totale ($)</p>
                    <p id="totalLoss" class="text-2xl font-bold">0</p>
                </div>
                <div class="p-4 bg-gray-800 rounded-lg">
                    <p class="text-sm text-gray-300">Taux de Réussite</p>
                    <p id="successRate" class="text-2xl font-bold">0%</p>
                </div>
            </div>
        </div>

        <!-- Tableau récapitulatif -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Trades Récapitulatifs</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-900">
                            <th class="border border-gray-700 p-3">Date</th>
                            <th class="border border-gray-700 p-3">Investissement ($)</th>
                            <th class="border border-gray-700 p-3">Gain/Perte ($)</th>
                            <th class="border border-gray-700 p-3">Capital Actuel ($)</th>
                            <th class="border border-gray-700 p-3">Notes</th>
                            <th class="border border-gray-700 p-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tradeTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="card p-6">
            <h2 class="text-2xl font-bold mb-4">Analyses Stellaires</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-xl font-semibold mb-2">Trajectoire du Capital</h3>
                    <canvas id="capitalChart" height="200"></canvas>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Gains vs Pertes</h3>
                    <canvas id="profitLossChart" height="200"></canvas>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Performance Mensuelle</h3>
                    <canvas id="monthlyChart" height="200"></canvas>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Répartition Gains/Pertes</h3>
                    <canvas id="donutChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Logos des cryptos (étendu avec beaucoup plus de cryptos Kraken)
        const cryptoLogos = {
            'BTC/USD': 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png?1696501400',
            'ETH/USD': 'https://assets.coingecko.com/coins/images/279/large/ethereum.png?1696501628',
            'XRP/USD': 'https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1696501442',
            'SOL/USD': 'https://assets.coingecko.com/coins/images/4128/large/solana.png?1696504756',
            'DOGE/USD': 'https://assets.coingecko.com/coins/images/5/large/dogecoin.png?1696501409',
            'ADA/USD': 'https://assets.coingecko.com/coins/images/975/large/cardano.png?1696502157',
            'SUI/USD': 'https://assets.coingecko.com/coins/images/26375/large/SUI.png?1696525453',
            'AAVE/USD': 'https://assets.coingecko.com/coins/images/12645/large/AAVE.png?1696512480',
            'LINK/USD': 'https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png?1696501909',
            'AVAX/USD': 'https://assets.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite_Trans.png?1696512369',
            'NEAR/USD': 'https://assets.coingecko.com/coins/images/10365/large/Near_Protocol_Logo.svg?1696510367',
            'XLM/USD': 'https://assets.coingecko.com/coins/images/100/large/Stellar_symbol_black_RGB.png?1696501482',
            'LTC/USD': 'https://assets.coingecko.com/coins/images/2/large/litecoin.png?1696501400',
            'DOT/USD': 'https://assets.coingecko.com/coins/images/12171/large/polkadot.png?1696512003',
            'MATIC/USD': 'https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png?1696505277',
            'SHIB/USD': 'https://assets.coingecko.com/coins/images/11939/large/shiba.png?1696511800',
            'UNI/USD': 'https://assets.coingecko.com/coins/images/12504/large/uniswap-uni.png?1696512319',
            'TRX/USD': 'https://assets.coingecko.com/coins/images/1094/large/tron-logo.png?1696502153',
            'BCH/USD': 'https://assets.coingecko.com/coins/images/780/large/bitcoin-cash-circle.png?1696501902',
            'EOS/USD': 'https://assets.coingecko.com/coins/images/738/large/eos-eos-logo.png?1696501891',
            'ALGO/USD': 'https://assets.coingecko.com/coins/images/4380/large/download.png?1696504978',
            'ATOM/USD': 'https://assets.coingecko.com/coins/images/1481/large/cosmos_hub.png?1696502525',
            'FIL/USD': 'https://assets.coingecko.com/coins/images/12817/large/filecoin.png?1696512520',
            'ICP/USD': 'https://assets.coingecko.com/coins/images/14495/large/Internet_Computer_logo.png?1696514180',
            'HBAR/USD': 'https://assets.coingecko.com/coins/images/3688/large/NxLm6Yc7_400x400.jpg?1696504370',
            'ETC/USD': 'https://assets.coingecko.com/coins/images/453/large/ethereum-classic-logo.png?1696501717',
            'XMR/USD': 'https://assets.coingecko.com/coins/images/69/large/monero_logo.png?1696501460',
            'APT/USD': 'https://assets.coingecko.com/coins/images/26455/large/aptos_round.png?1696525529',
            'RNDR/USD': 'https://assets.coingecko.com/coins/images/11636/large/rndr.png?1696511529',
            'STX/USD': 'https://assets.coingecko.com/coins/images/10620/large/NxLm6Yc7_400x400.jpg?1696510367',
            'IMX/USD': 'https://assets.coingecko.com/coins/images/17233/large/imx.png?1696516751',
            'AR/USD': 'https://assets.coingecko.com/coins/images/4380/large/NxLm6Yc7_400x400.png?1696504978',
            'GRT/USD': 'https://assets.coingecko.com/coins/images/13397/large/Graph_Token.png?1696513205',
            'MKR/USD': 'https://assets.coingecko.com/coins/images/1364/large/Mark_Maker.png?1696502423',
            'PEPE/USD': 'https://assets.coingecko.com/coins/images/29850/large/pepe1.png?1696528776',
            'LDO/USD': 'https://assets.coingecko.com/coins/images/13539/large/Lido_DAO_Token_100x100.png?1696513276',
            'QNT/USD': 'https://assets.coingecko.com/coins/images/3370/large/5ZOu7brX_400x400.jpg?1696504057',
            'FET/USD': 'https://assets.coingecko.com/coins/images/5681/large/Fetch.jpg?1696506677',
            'SAND/USD': 'https://assets.coingecko.com/coins/images/12129/large/the_sandbox_logo.jpg?1696511971',
            'MANA/USD': 'https://assets.coingecko.com/coins/images/878/large/decentraland-mana.png?1696501928',
            'AXS/USD': 'https://assets.coingecko.com/coins/images/13029/large/axie_infinity_logo.png?1696512817',
            'GALA/USD': 'https://assets.coingecko.com/coins/images/12493/large/Gala_Logo_%281%29.png?1696512310',
            'CHZ/USD': 'https://assets.coingecko.com/coins/images/8834/large/Chiliz.png?1696509346',
            'CRV/USD': 'https://assets.coingecko.com/coins/images/12124/large/Curve.png?1696511967',
            'SNX/USD': 'https://assets.coingecko.com/coins/images/3406/large/SNX.png?1696504103',
            'COMP/USD': 'https://assets.coingecko.com/coins/images/10775/large/COMP.png?1696510607',
            '1INCH/USD': 'https://assets.coingecko.com/coins/images/13469/large/1inch-token.png?1696513230',
            'ZRX/USD': 'https://assets.coingecko.com/coins/images/863/large/0x.png?1696501896',
            'BAT/USD': 'https://assets.coingecko.com/coins/images/681/large/BAT_icon.png?1696501595',
            'ENJ/USD': 'https://assets.coingecko.com/coins/images/1102/large/enjin-coin-logo.png?1696502200',
            'YFI/USD': 'https://assets.coingecko.com/coins/images/11849/large/yearn.jpg?1696511720',
            'BAL/USD': 'https://assets.coingecko.com/coins/images/11683/large/Balancer.png?1696511570',
            'KSM/USD': 'https://assets.coingecko.com/coins/images/9568/large/NxLm6Yc7_400x400.jpg?1696509604',
            'GLM/USD': 'https://assets.coingecko.com/coins/images/542/large/Golem_Submark_Positive_RGB.png?1696501622',
            'OCEAN/USD': 'https://assets.coingecko.com/coins/images/3687/large/ocean-protocol-logo.jpg?1696504363',
            'POWR/USD': 'https://assets.coingecko.com/coins/images/1104/large/Power_Ledger_Token.png?1696502206',
            'STORJ/USD': 'https://assets.coingecko.com/coins/images/949/large/Storj.png?1696502071',
            'ZEC/USD': 'https://assets.coingecko.com/coins/images/486/large/circle-zcash-color.png?1696501570',
            'DASH/USD': 'https://assets.coingecko.com/coins/images/19/large/dash-logo.png?1696501423',
            'XTZ/USD': 'https://assets.coingecko.com/coins/images/976/large/Tezos-logo.png?1696502091',
            'WAVES/USD': 'https://assets.coingecko.com/coins/images/425/large/Waves.png?1696501731',
            'OMG/USD': 'https://assets.coingecko.com/coins/images/690/large/OMG_Network.jpg?1696501817',
            'KNC/USD': 'https://assets.coingecko.com/coins/images/14899/large/RzUVoNp-400x400.jpg?1696514556',
            'REP/USD': 'https://assets.coingecko.com/coins/images/647/large/augur-logo.png?1696501743',
            'PAXG/USD': 'https://assets.coingecko.com/coins/images/9519/large/Pax_Gold.png?1696509434',
            'TBTC/USD': 'https://assets.coingecko.com/coins/images/11224/large/tBTC.png?1696511185',
            'USDT/USD': 'https://assets.coingecko.com/coins/images/325/large/Tether.png?1696501661',
            'USDC/USD': 'https://assets.coingecko.com/coins/images/6319/large/usdc.png?1696506694',
            'DAI/USD': 'https://assets.coingecko.com/coins/images/9956/large/Badge_Dai.png?1696509996'
        };

        let signalChart = null;
        let tradeAnalysisChart = null;
        let capitalChart = null;
        let profitLossChart = null;
        let monthlyChart = null;
        let donutChart = null;

        // Mapping CoinGecko IDs to symbols
        const coinMap = {
            'bitcoin': 'BTC',
            'ethereum': 'ETH',
            'ripple': 'XRP',
            'solana': 'SOL',
            'dogecoin': 'DOGE',
            'cardano': 'ADA',
            'sui': 'SUI',
            'aave': 'AAVE',
            'chainlink': 'LINK',
            'avalanche-2': 'AVAX',
            'near-protocol': 'NEAR',
            'stellar': 'XLM',
            'litecoin': 'LTC',
            'polkadot': 'DOT',
            'polygon': 'MATIC',
            'shiba-inu': 'SHIB',
            'uniswap': 'UNI',
            'tron': 'TRX',
            'bitcoin-cash': 'BCH',
            'eos': 'EOS',
            'algorand': 'ALGO',
            'cosmos': 'ATOM',
            'filecoin': 'FIL',
            'internet-computer': 'ICP',
            'hedera': 'HBAR',
            'ethereum-classic': 'ETC',
            'monero': 'XMR',
            'aptos': 'APT',
            'render': 'RNDR',
            'stacks': 'STX',
            'immutable': 'IMX',
            'arweave': 'AR',
            'the-graph': 'GRT',
            'maker': 'MKR',
            'pepe': 'PEPE',
            'lido-dao': 'LDO',
            'quant-network': 'QNT',
            'artificial-superintelligence-alliance': 'FET',
            'the-sandbox': 'SAND',
            'decentraland': 'MANA',
            'axie-infinity': 'AXS',
            'gala': 'GALA',
            'chiliz': 'CHZ',
            'curve-dao-token': 'CRV',
            'synthetix': 'SNX',
            'compound': 'COMP',
            '1inch': '1INCH',
            '0x-protocol': 'ZRX',
            'basic-attention': 'BAT',
            'enjin-coin': 'ENJ',
            'yearn-finance': 'YFI',
            'balancer': 'BAL',
            'kusama': 'KSM',
            'golem': 'GLM',
            'ocean-protocol': 'OCEAN',
            'power-ledger': 'POWR',
            'storj': 'STORJ',
            'zcash': 'ZEC',
            'dash': 'DASH',
            'tezos': 'XTZ',
            'waves': 'WAVES',
            'omg-network': 'OMG',
            'kyber-network-crystal': 'KNC',
            'augur': 'REP',
            'pax-gold': 'PAXG',
            'tbtc': 'TBTC',
            'tether': 'USDT',
            'usd-coin': 'USDC',
            'dai': 'DAI'
        };
        const coinIds = Object.keys(coinMap);

        // Ajouter des logos flottants dynamiques
        for (let i = 0; i < 20; i++) {
            const logoKeys = Object.keys(cryptoLogos);
            const randomKey = logoKeys[Math.floor(Math.random() * logoKeys.length)];
            const img = document.createElement('img');
            img.src = cryptoLogos[randomKey];
            img.className = 'floating-logo';
            img.style.width = `${Math.random() * 30 + 30}px`;
            img.style.height = 'auto';
            img.style.top = `${Math.random() * 100}%`;
            img.style.left = '100vw';
            img.style.animationDuration = `${Math.random() * 10 + 15}s`;
            img.style.opacity = Math.random() * 0.4 + 0.3;
            document.querySelector('.starfield').appendChild(img);
        }

        // Mettre à jour les prix en temps réel
        function updateLivePrices() {
            fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds.join(',')}&vs_currencies=usd`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('livePrices');
                    container.innerHTML = '';
                    coinIds.forEach(id => {
                        if (data[id]) {
                            const symbol = coinMap[id];
                            const div = document.createElement('div');
                            div.className = 'p-2 bg-gray-800 rounded-lg flex items-center';
                            div.innerHTML = `<img src="${cryptoLogos[`${symbol}/USD`] || ''}" class="crypto-logo" alt="${symbol}"> ${symbol}: $${data[id].usd.toFixed(2)}`;
                            container.appendChild(div);
                        }
                    });
                })
                .catch(error => console.error('Erreur lors de la mise à jour des prix:', error));
        }
        updateLivePrices();
        setInterval(updateLivePrices, 30000);

        // Charger les trades
        async function loadTrades() {
            try {
                const response = await fetch('https://autonomix-elec.onrender.com/trades');
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                let trades = await response.json();
                
                trades = trades.sort((a, b) => new Date(a.trade_date) - new Date(b.trade_date));
                const tableBody = document.getElementById('tradeTableBody');
                tableBody.innerHTML = '';

                trades.forEach(trade => {
                    const row = document.createElement('tr');
                    row.className = trade.profit_loss >= 0 ? 'bg-blue-900' : 'bg-purple-900';
                    row.innerHTML = `
                        <td class="border border-gray-700 p-3">${trade.trade_date}</td>
                        <td class="border border-gray-700 p-3">${parseFloat(trade.investment || 0).toFixed(2)}</td>
                        <td class="border border-gray-700 p-3">${parseFloat(trade.profit_loss || 0).toFixed(2)}</td>
                        <td class="border border-gray-700 p-3">${parseFloat(trade.current_capital || 0).toFixed(2)}</td>
                        <td class="border border-gray-700 p-3">${trade.notes || ''}</td>
                        <td class="border border-gray-700 p-3">
                            <button onclick="deleteTrade(${trade.id})" class="btn-danger p-2 rounded">Supprimer</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                const totalTrades = trades.length;
                const totalProfit = trades.reduce((sum, trade) => trade.profit_loss > 0 ? sum + parseFloat(trade.profit_loss || 0) : sum, 0);
                const totalLoss = trades.reduce((sum, trade) => trade.profit_loss < 0 ? sum + Math.abs(parseFloat(trade.profit_loss || 0)) : sum, 0);
                const successRate = totalTrades ? ((trades.filter(trade => trade.profit_loss >= 0).length / totalTrades) * 100).toFixed(2) : 0;
                const latestCapital = trades.length ? parseFloat(trades[trades.length - 1].current_capital || 0) : 0;

                document.getElementById('totalTrades').textContent = totalTrades;
                document.getElementById('totalProfit').textContent = totalProfit.toFixed(2);
                document.getElementById('totalLoss').textContent = totalLoss.toFixed(2);
                document.getElementById('successRate').textContent = `${successRate}%`;

                const progress = Math.min((latestCapital / 1000000) * 100, 100);
                document.getElementById('progressBarFill').style.width = `${progress}%`;
                document.getElementById('progressText').textContent = `${progress.toFixed(2)}% complété`;

                if (totalTrades && totalProfit > 0) {
                    const avgProfitPerTrade = totalProfit / trades.filter(trade => trade.profit_loss > 0).length;
                    const tradesNeeded = Math.ceil((1000000 - latestCapital) / avgProfitPerTrade);
                    const monthsNeeded = Math.ceil(tradesNeeded / (totalTrades / (trades.length / 30)));
                    const estimatedDate = new Date();
                    estimatedDate.setMonth(estimatedDate.getMonth() + monthsNeeded);
                    document.getElementById('forecastText').textContent = `Estimation : ${estimatedDate.toLocaleString('fr-FR', { month: 'long', year: 'numeric' })}`;
                } else {
                    document.getElementById('forecastText').textContent = 'Estimation : -';
                }

                updateCharts(trades);
            } catch (error) {
                console.error('Erreur lors du chargement des trades:', error);
            }
        }

        // Ajouter un trade
        document.getElementById('tradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const trade = {
                trade_date: document.getElementById('trade_date').value,
                investment: parseFloat(document.getElementById('investment').value),
                profit_loss: parseFloat(document.getElementById('profit_loss').value),
                current_capital: parseFloat(document.getElementById('current_capital').value),
                notes: document.getElementById('notes').value
            };
            try {
                const response = await fetch('https://autonomix-elec.onrender.com/trades', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trade)
                });
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                if (trade.profit_loss > 0) {
                    const supernova = document.createElement('div');
                    supernova.className = 'supernova';
                    document.body.appendChild(supernova);
                    setTimeout(() => supernova.remove(), 2000);
                }
                e.target.reset();
                loadTrades();
            } catch (error) {
                console.error('Erreur lors de l\'ajout du trade:', error);
            }
        });

        // Lancer l’analyse crypto
        document.getElementById('analyzeButton').addEventListener('click', async () => {
            try {
                document.getElementById('loadingSpinner').style.display = 'inline-block';
                document.getElementById('signalResult').classList.add('hidden');
                const response = await fetch('https://autonomix-elec.onrender.com/api/crypto-analysis');
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                const signal = await response.json();
                document.getElementById('signalLogo').src = cryptoLogos[signal.pair] || '';
                document.getElementById('signalPair').textContent = signal.pair || 'N/A';
                document.getElementById('signalType').textContent = signal.signal || 'N/A';
                document.getElementById('signalPrice').textContent = signal.price ? signal.price.toFixed(2) : 'N/A';
                document.getElementById('signalTarget').textContent = signal.target ? signal.target.toFixed(2) : 'N/A';
                document.getElementById('signalStopLoss').textContent = signal.stop_loss ? signal.stop_loss.toFixed(2) : 'N/A';
                document.getElementById('signalRsi').textContent = signal.rsi ? signal.rsi.toFixed(2) : 'N/A';
                document.getElementById('signalAtr').textContent = signal.atr ? signal.atr.toFixed(2) : 'N/A';
                document.getElementById('signalSupport').textContent = signal.support ? signal.support.toFixed(2) : 'N/A';
                document.getElementById('signalResistance').textContent = signal.resistance ? signal.resistance.toFixed(2) : 'N/A';
                document.getElementById('signalConfidence').textContent = signal.confidence || 'N/A';
                document.getElementById('signalScore').textContent = signal.score ? signal.score.toFixed(1) : 'N/A';
                document.getElementById('signalReason').textContent = signal.reason || 'N/A';
                document.getElementById('signalResult').classList.remove('hidden');
                
                if (signal.score > 80) {
                    const supernova = document.createElement('div');
                    supernova.className = 'supernova';
                    document.body.appendChild(supernova);
                    setTimeout(() => supernova.remove(), 2000);
                }

                updateSignalChart(signal.price_history, signal.support, signal.resistance);
            } catch (error) {
                console.error('Erreur lors de l\'analyse crypto:', error);
                document.getElementById('signalResult').innerHTML = `<p class="text-red-500">Erreur : ${error.message}</p>`;
                document.getElementById('signalResult').classList.remove('hidden');
            } finally {
                document.getElementById('loadingSpinner').style.display = 'none';
            }
        });

        // Analyser un trade soumis
        document.getElementById('tradeAnalysisForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                document.getElementById('tradeAnalysisSpinner').style.display = 'inline-block';
                document.getElementById('tradeAnalysisResult').classList.add('hidden');
                const trade = {
                    pair: document.getElementById('tradePair').value,
                    entry_price: parseFloat(document.getElementById('entryPrice').value),
                    signal_type: document.getElementById('tradeSignalType').value
                };
                const response = await fetch('https://autonomix-elec.onrender.com/api/analyze-trade', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trade)
                });
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                const result = await response.json();
                document.getElementById('tradeRecommendation').textContent = result.recommendation || 'N/A';
                document.getElementById('tradeReason').textContent = result.reason || 'N/A';
                document.getElementById('tradeScore').textContent = result.score ? result.score.toFixed(1) : 'N/A';
                document.getElementById('tradeCurrentPrice').textContent = result.current_price ? result.current_price.toFixed(2) : 'N/A';
                document.getElementById('tradeSupport').textContent = result.support ? result.support.toFixed(2) : 'N/A';
                document.getElementById('tradeResistance').textContent = result.resistance ? result.resistance.toFixed(2) : 'N/A';
                document.getElementById('tradeRsi').textContent = result.rsi ? result.rsi.toFixed(2) : 'N/A';
                document.getElementById('tradeAtr').textContent = result.atr ? result.atr.toFixed(2) : 'N/A';
                document.getElementById('tradeAnalysisResult').classList.remove('hidden');

                updateTradeAnalysisChart(result.price_history, result.support, result.resistance);
            } catch (error) {
                console.error('Erreur lors de l\'analyse du trade:', error);
                document.getElementById('tradeAnalysisResult').innerHTML = `<p class="text-red-500">Erreur : ${error.message}</p>`;
                document.getElementById('tradeAnalysisResult').classList.remove('hidden');
            } finally {
                document.getElementById('tradeAnalysisSpinner').style.display = 'none';
            }
        });

        // Supprimer un trade
        async function deleteTrade(id) {
            try {
                const response = await fetch(`https://autonomix-elec.onrender.com/trades/${id}`, { method: 'DELETE' });
                if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                loadTrades();
            } catch (error) {
                console.error('Erreur lors de la suppression du trade:', error);
            }
        }

        // Options communes pour zoom et pan sur les graphiques
        const zoomOptions = {
            zoom: {
                wheel: { enabled: true },
                pinch: { enabled: true },
                mode: 'xy'
            },
            pan: {
                enabled: true,
                mode: 'xy'
            }
        };

        // Mettre à jour le graphique de l’analyse crypto
        function updateSignalChart(priceHistory, support, resistance) {
            const ctx = document.getElementById('signalChart').getContext('2d');
            if (signalChart) signalChart.destroy();
            const labels = priceHistory.map(data => new Date(data.timestamp).toLocaleDateString());
            const prices = priceHistory.map(data => data.close);
            signalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Prix ($)',
                            data: prices,
                            borderColor: '#60a5fa',
                            backgroundColor: 'rgba(96, 165, 250, 0.2)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Support (1d)',
                            data: Array(prices.length).fill(support),
                            borderColor: '#34d399',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Résistance (1d)',
                            data: Array(prices.length).fill(resistance),
                            borderColor: '#f87171',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Analyse des Prix', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    },
                    scales: {
                        y: { title: { display: true, text: 'Prix ($)', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                        x: { title: { display: true, text: 'Date', color: '#ffffff' }, ticks: { color: '#ffffff' } }
                    }
                }
            });
        }

        // Mettre à jour le graphique de l’analyse de trade
        function updateTradeAnalysisChart(priceHistory, support, resistance) {
            const ctx = document.getElementById('tradeAnalysisChart').getContext('2d');
            if (tradeAnalysisChart) tradeAnalysisChart.destroy();
            const labels = priceHistory.map(data => new Date(data.timestamp).toLocaleDateString());
            const prices = priceHistory.map(data => data.close);
            tradeAnalysisChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Prix ($)',
                            data: prices,
                            borderColor: '#60a5fa',
                            backgroundColor: 'rgba(96, 165, 250, 0.2)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Support (1d)',
                            data: Array(prices.length).fill(support),
                            borderColor: '#34d399',
                            borderDash: [5, 5],
                            pointRadius: 0
                        },
                        {
                            label: 'Résistance (1d)',
                            data: Array(prices.length).fill(resistance),
                            borderColor: '#f87171',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Analyse de Votre Trade', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    },
                    scales: {
                        y: { title: { display: true, text: 'Prix ($)', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                        x: { title: { display: true, text: 'Date', color: '#ffffff' }, ticks: { color: '#ffffff' } }
                    }
                }
            });
        }

        // Mettre à jour les graphiques de suivi
        function updateCharts(trades) {
            const capitalCtx = document.getElementById('capitalChart').getContext('2d');
            if (capitalChart) capitalChart.destroy();
            capitalChart = new Chart(capitalCtx, {
                type: 'line',
                data: {
                    labels: trades.map(trade => trade.trade_date),
                    datasets: [{
                        label: 'Capital ($)',
                        data: trades.map(trade => parseFloat(trade.current_capital || 0)),
                        borderColor: '#60a5fa',
                        backgroundColor: 'rgba(96, 165, 250, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Trajectoire du Capital', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Capital ($)', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                        x: { title: { display: true, text: 'Date', color: '#ffffff' }, ticks: { color: '#ffffff' } }
                    }
                }
            });

            const profitLossCtx = document.getElementById('profitLossChart').getContext('2d');
            if (profitLossChart) profitLossChart.destroy();
            profitLossChart = new Chart(profitLossCtx, {
                type: 'bar',
                data: {
                    labels: trades.map(trade => trade.trade_date),
                    datasets: [{
                        label: 'Gain/Perte ($)',
                        data: trades.map(trade => parseFloat(trade.profit_loss || 0)),
                        backgroundColor: trades.map(trade => trade.profit_loss >= 0 ? 'rgba(96, 165, 250, 0.7)' : 'rgba(168, 85, 247, 0.7)')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Gains vs Pertes', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    },
                    scales: {
                        y: { title: { display: true, text: 'Montant ($)', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                        x: { title: { display: true, text: 'Date', color: '#ffffff' }, ticks: { color: '#ffffff' } }
                    }
                }
            });

            const monthlyData = trades.reduce((acc, trade) => {
                const month = new Date(trade.trade_date).toLocaleString('fr-FR', { year: 'numeric', month: 'short' });
                acc[month] = (acc[month] || 0) + parseFloat(trade.profit_loss || 0);
                return acc;
            }, {});
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            if (monthlyChart) monthlyChart.destroy();
            monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: 'Performance Mensuelle ($)',
                        data: Object.values(monthlyData),
                        backgroundColor: Object.values(monthlyData).map(value => value >= 0 ? 'rgba(96, 165, 250, 0.7)' : 'rgba(168, 85, 247, 0.7)')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Performance Mensuelle', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    },
                    scales: {
                        y: { title: { display: true, text: 'Montant ($)', color: '#ffffff' }, ticks: { color: '#ffffff' } },
                        x: { title: { display: true, text: 'Mois', color: '#ffffff' }, ticks: { color: '#ffffff' } }
                    }
                }
            });

            const donutCtx = document.getElementById('donutChart').getContext('2d');
            if (donutChart) donutChart.destroy();
            donutChart = new Chart(donutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Gains ($)', 'Pertes ($)'],
                    datasets: [{
                        data: [
                            trades.reduce((sum, trade) => trade.profit_loss > 0 ? sum + parseFloat(trade.profit_loss || 0) : sum, 0),
                            trades.reduce((sum, trade) => trade.profit_loss < 0 ? sum + Math.abs(parseFloat(trade.profit_loss || 0)) : sum, 0)
                        ],
                        backgroundColor: ['rgba(96, 165, 250, 0.7)', 'rgba(168, 85, 247, 0.7)']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff' } },
                        title: { display: true, text: 'Répartition Gains/Pertes', color: '#ffffff', font: { size: 16 } },
                        zoom: zoomOptions
                    }
                }
            });
        }

        // Charger les trades au démarrage
        loadTrades();
    </script>
</body>
</html>
