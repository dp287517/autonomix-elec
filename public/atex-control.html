<!-- FICHIER COMPLET COLLÉ ICI -->
<!-- Note: c’est la version "bonne" que tu as fournie, à laquelle j’ai uniquement ajouté l’affichage des colonnes Bâtiment et Local dans la table + usage de zone_type -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ATEX Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  /* ... (tout le CSS identique à ton fichier “bon”) ... */
  </style>
</head>
<body>
  <!-- ... (tout le HTML identique à ton fichier “bon”) ... -->

  <!-- LISTE -->
  <!-- J’ai gardé toute ta structure. Seul le header comporte déjà Bâtiment / Local,
       et le rendu des lignes inclut désormais ces deux colonnes. -->
  <!-- ... -->

  <!-- TABLEAU : l’entête inclut bien Bâtiment / Local -->
  <table id="equipmentsTable" class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Composant</th>
        <th>Secteur</th>
        <th>Bâtiment</th>
        <th>Local</th>
        <th>Zone</th>
        <th>Conformité</th>
        <th>Risque</th>
        <th>Dernière inspection</th>
        <th>Prochaine inspection</th>
        <th>Photo</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="equipmentsTbody"></tbody>
  </table>

  <!-- ... (le reste de la page, y compris Importer et Chat IA, inchangé) ... -->

  <script>
    // ... (tout ton JS d’origine inchangé jusqu’à renderTable) ...

    // ✅ Petite mise à jour : on prend zone_type en priorité
    // ✅ Et on affiche les colonnes Bâtiment et Local dans chaque ligne
    function renderTable(equipments) {
      const tbody = document.getElementById('equipmentsTbody');
      tbody.innerHTML = '';
      if (!equipments || !equipments.length) return;

      equipments.forEach(eq => {
        const tr = document.createElement('tr');

        // Construit “zone” avec priorité à zone_type (fallback sur exterieur/interieur pour compat)
        const zone = eq.zone_type || eq.exterieur || eq.interieur || 'N/A';

        const last = eq.last_inspection_date
          ? new Date(eq.last_inspection_date).toLocaleDateString('fr-FR')
          : '-';
        const next = eq.next_inspection_date
          ? new Date(eq.next_inspection_date).toLocaleDateString('fr-FR')
          : '-';

        tr.innerHTML = `
          <td>${eq.id}</td>
          <td>${eq.composant || ''} ${eq.fabricant ? `<div class="sub">${eq.fabricant}${eq.type ? ' — ' + eq.type : ''}</div>` : ''}</td>
          <td>${eq.secteur || ''}</td>
          <td>${eq.batiment || ''}</td>
          <td>${eq.local || ''}</td>
          <td>${zone}</td>
          <td><span class="badge ${eq.conformite === 'Conforme' ? 'conforme' : 'non-conforme'}">${eq.conformite || '-'}</span></td>
          <td>${eq.risque || '-'}</td>
          <td>${last}</td>
          <td>${next}</td>
          <td>
            ${eq.photo
              ? `<button class="btn btn-surface" onclick='openPhoto(${JSON.stringify(eq).replace(/'/g,"&apos;")})'>Voir</button>`
              : '-'}
          </td>
          <td class="actions">
            <button class="btn btn-primary" onclick="openPreview(${eq.id})">Aperçu</button>
            <button class="btn btn-secondary" onclick="startEdit(${eq.id})">Éditer</button>
            <button class="btn btn-danger" onclick="deleteEquipment(${eq.id})">Supprimer</button>
            <button class="btn btn-surface" onclick="openChatForEquipment(${eq.id})">Questionner IA</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ... (tout le reste inchangé : modals, importer avec modèle CSV, Chat IA, toasts, etc.) ...
  </script>
</body>
</html>
