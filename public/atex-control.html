<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrôle des Équipements ATEX</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/app.css">
</head>
<body>
  <div class="container">
    <h1>Contrôle des Équipements ATEX</h1>
    <p>Inspecter, ajouter et suivre les conformités ATEX.</p>

    <ul class="nav nav-tabs">
      <li class="nav-item"><a class="nav-link active" href="#">Liste</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Ajouter/Éditer</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Chat IA</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Importer</a></li>
      <li class="nav-item"><a class="nav-link" href="#">Explications</a></li>
    </ul>

    <section>
      <h2>Filtres</h2>
      <form>
        <select id="filter-secteur" class="select"></select>
        <select id="filter-conformite" class="select">
          <option>Conformité</option>
          <option>Conforme</option>
          <option>Non Conforme</option>
        </select>
        <select id="filter-statut" class="select">
          <option>Statut</option>
          <option>En retard</option>
          <option>Aujourd’hui</option>
          <option>Bientôt</option>
          <option>OK</option>
        </select>
        <button type="reset" class="btn btn-secondary">Effacer</button>
        <button type="submit" class="btn btn-primary">Appliquer</button>
      </form>
    </section>

    <section>
      <h2>Liste des Équipements</h2>
      <button class="btn btn-danger">Supprimer sélection</button>
      <button class="btn btn-primary">Sync</button>
      <table id="equipmentsTable" class="table">
        <thead>
          <tr>
            <th>ID</th><th>Composant</th><th>Secteur</th><th>Bâtiment</th><th>Local</th>
            <th>Zone G</th><th>Zone D</th><th>Conformité</th><th>Statut</th><th>Risque</th>
            <th>Dernière</th><th>Prochaine</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section>
      <h2>Ajouter/Éditer</h2>
      <form id="equipment-form">
        <select id="secteur" class="select"></select>
        <input id="batiment" placeholder="Bâtiment" class="form-control">
        <input id="local" placeholder="Local" class="form-control">
        <select id="zone_gaz" class="select">
          <option>Zone ATEX (Gaz)</option>
          <option>0 (Gaz)</option>
          <option>1 (Gaz)</option>
          <option>2 (Gaz)</option>
        </select>
        <select id="zone_poussieres" class="select">
          <option>Zone ATEX (Poussières)</option>
          <option>20 (Poussières)</option>
          <option>21 (Poussières)</option>
          <option>22 (Poussières)</option>
        </select>
        <input id="composant" placeholder="Composant" required class="form-control">
        <input id="fabricant" placeholder="Fabricant" required class="form-control">
        <input id="type" placeholder="Type" required class="form-control">
        <input id="identifiant" placeholder="Identifiant" class="form-control">
        <input id="marquage_atex" placeholder="Marquage ATEX" required class="form-control">
        <textarea id="comments" placeholder="Commentaires" class="form-control"></textarea>
        <input id="last_inspection_date" type="date" class="form-control">
        <input id="frequence" type="number" placeholder="Fréquence (mois)" value="36" class="form-control">
        <button type="submit" class="btn btn-primary">Sauvegarder</button>
      </form>
    </section>

    <section>
      <h2>Importer</h2>
      <input id="import-file" type="file" accept=".xlsx,.csv">
      <button id="import-btn" class="btn btn-primary">Importer</button>
    </section>

    <!-- Modal Viewer (added complete) -->
    <div id="attViewerModal" class="modal fade" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="attViewerTitle" class="modal-title">Pièce jointe</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" style="height: 70vh;">
            <div id="attViewerStage" class="h-100"></div>
          </div>
          <div class="modal-footer">
            <span id="attViewerMeta"></span>
            <button id="attPrev" class="btn btn-secondary">Précédent</button>
            <button id="attNext" class="btn btn-secondary">Suivant</button>
            <a id="attOpen" class="btn btn-primary" target="_blank">Ouvrir</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Modal (added) -->
    <div id="deleteModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirmer suppression</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p id="deleteMsg"></p>
            <p id="deleteMeta"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
            <button id="confirmDeleteBtn" class="btn btn-danger">Supprimer</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>© AutonomiX — Tous droits réservés</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/atex-control.js"></script>
</body>
</html>
