<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EPD Builder - DRPCE / AutonomiX</title>

  <!-- üîê Garde d'acc√®s externalis√©e (comme ATEX) -->
  <script src="/js/epd-guard.js" defer></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.453.0/font/lucide.css" rel="stylesheet"/>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.453.0/dist/umd/lucide.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>

  <style>
    :root{ --offcanvas-w: clamp(420px, 40vw, 560px); }
    body{ background:#f8f9fa; font-family:'Poppins',sans-serif; color:#333; }
    .card{ border-radius:14px; box-shadow:0 4px 10px rgba(0,0,0,.06); }
    .small-muted{ font-size:.9rem; color:#6c757d; }
    .offcanvas-ia{ --bs-offcanvas-width: var(--offcanvas-w); }
    .pill{border:1px solid #e9ecef; border-radius:999px; padding:.15rem .6rem; font-size:.8rem; color:#6c757d; background:#fff;}
    .code{ font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace }
    .thumb{ width:84px; height:84px; object-fit:cover; border:1px solid #dee2e6; border-radius:8px; }
    .status-dot{ display:inline-block; width:10px; height:10px; border-radius:50%; margin-left:.4rem; vertical-align:middle; }
    .status-green{ background:#28a745; }
    .status-orange{ background:#fd7e14; }
    .tab-disabled .nav-link:not(.active){ pointer-events:none; opacity:.5; }
    #projTableWrap{ max-height: 50vh; overflow:auto; }
  </style>
</head>
<body class="container my-5">

  <header class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 class="mb-1">EPD / DRPCE ‚Äî AutonomiX</h1>
      <p class="lead mb-0">Cr√©er, guider et documenter vos EPD avec IA int√©gr√©e.</p>
    </div>
    <div class="d-flex gap-2 flex-wrap">
      <a class="btn btn-outline-secondary" href="dashboard.html"><i data-lucide="home"></i> Menu</a>
      <a class="btn btn-outline-secondary" href="atex-control.html"><i data-lucide="shield"></i> ATEX Control</a>
      <a class="btn btn-secondary" href="epd.html"><i data-lucide="file-text"></i> EPD</a>
    </div>
  </header>

  <!-- Guide -->
  <div class="card mb-3">
    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
      <div class="small">
        <strong>Guide :</strong>
        <span class="ms-2">Projets <span id="st-projects" class="status-dot status-orange"></span></span>
        <span class="ms-3">Contexte <span id="st-context" class="status-dot status-orange"></span></span>
        <span class="ms-3">Zonage <span id="st-zoning" class="status-dot status-orange"></span></span>
        <span class="ms-3">√âquipements <span id="st-equip" class="status-dot status-orange"></span></span>
        <span class="ms-3">Mesures <span id="st-measures" class="status-dot status-orange"></span></span>
        <span class="ms-3">G√©n√©ration <span id="st-build" class="status-dot status-orange"></span></span>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" id="btnNext"><i data-lucide="chevron-right"></i> Suivant</button>
        <button class="btn btn-outline-success btn-sm" id="btnBuild"><i data-lucide="wand-2"></i> G√©n√©rer</button>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="epdTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab">Projets</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="context-tab" data-bs-toggle="tab" data-bs-target="#context" type="button" role="tab">Contexte</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="zoning-tab" data-bs-toggle="tab" data-bs-target="#zoning" type="button" role="tab">Zonage</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="equip-tab" data-bs-toggle="tab" data-bs-target="#equip" type="button" role="tab">√âquipements</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="measures-tab" data-bs-toggle="tab" data-bs-target="#measures" type="button" role="tab">Mesures</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="build-tab" data-bs-toggle="tab" data-bs-target="#build" type="button" role="tab">G√©n√©ration</button>
    </li>
  </ul>

  <!-- Contenu des onglets -->
  <div class="tab-content">

    <!-- Projects -->
    <div class="tab-pane fade show active" id="projects" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Vos projets EPD</h5>
            <div class="d-flex gap-2">
              <button id="btnNewProject" class="btn btn-primary btn-sm"><i data-lucide="plus"></i> Nouveau</button>
              <input id="searchProject" class="form-control form-control-sm" placeholder="Rechercher..." style="width: 220px;">
            </div>
          </div>
          <div id="projTableWrap" class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>Secteur</th>
                  <th>B√¢timent</th>
                  <th>Local</th>
                  <th>Maj</th>
                  <th style="width:130px;"></th>
                </tr>
              </thead>
              <tbody id="projTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Context -->
    <div class="tab-pane fade" id="context" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <h5>Contexte</h5>
          <textarea id="contextText" class="form-control" rows="6" placeholder="D√©crivez le contexte..."></textarea>
          <div class="form-text">Ce texte alimentera la g√©n√©ration de l‚ÄôEPD.</div>
        </div>
      </div>
    </div>

    <!-- Zoning -->
    <div class="tab-pane fade" id="zoning" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <h5>Zonage</h5>
          <div class="row g-3">
            <div class="col-md-4"><input id="zoneType" class="form-control" placeholder="Type de zone (Gaz/Poussi√®res)" /></div>
            <div class="col-md-4"><input id="zoneGaz" class="form-control" placeholder="Zone Gaz (ex: 1, 2)" /></div>
            <div class="col-md-4"><input id="zonePoussiere" class="form-control" placeholder="Zone Poussi√®res (ex: 21, 22)" /></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Equipements -->
    <div class="tab-pane fade" id="equip" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">√âquipements</h5>
            <div class="d-flex gap-2">
              <input id="equipSearch" class="form-control form-control-sm" placeholder="Recherche (composant, marquage, fournisseur)" style="width: 320px;">
              <button id="btnAddEquip" class="btn btn-outline-primary btn-sm"><i data-lucide="plus"></i> Ajouter</button>
              <button id="btnAskIA" class="btn btn-outline-secondary btn-sm"><i data-lucide="bot"></i> IA</button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Composant</th>
                  <th>Fournisseur</th>
                  <th>Type</th>
                  <th>Identifiant</th>
                  <th>Marquage ATEX</th>
                  <th>Conformit√©</th>
                  <th style="width:110px;"></th>
                </tr>
              </thead>
              <tbody id="equipTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Mesures -->
    <div class="tab-pane fade" id="measures" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <h5>Mesures</h5>
          <textarea id="measuresText" class="form-control" rows="5" placeholder="Lister les mesures de pr√©vention/protection‚Ä¶"></textarea>
        </div>
      </div>
    </div>

    <!-- Build -->
    <div class="tab-pane fade" id="build" role="tabpanel">
      <div class="card">
        <div class="card-body">
          <h5>G√©n√©ration</h5>
          <div class="mb-2">
            <button id="btnGenerate" class="btn btn-success"><i data-lucide="wand-2"></i> G√©n√©rer l‚ÄôEPD</button>
            <span id="buildStatus" class="small-muted ms-2"></span>
          </div>
          <div id="buildOutput" class="border rounded p-3 bg-white" style="min-height: 200px;">
            <em class="text-muted">Le contenu g√©n√©r√© s‚Äôaffichera ici‚Ä¶</em>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /.tab-content -->

  <!-- Offcanvas IA -->
  <div class="offcanvas offcanvas-end offcanvas-ia" tabindex="-1" id="offIA">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Assistant IA ‚Äî ATEX</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div class="mb-2">
        <textarea id="iaQuestion" class="form-control" rows="3" placeholder="Posez votre question (contexte ATEX)‚Ä¶"></textarea>
      </div>
      <div class="d-flex justify-content-end mb-3">
        <button id="btnIaAsk" class="btn btn-primary"><i data-lucide="send"></i> Envoyer</button>
      </div>
      <div id="iaResponse" class="border rounded p-3 bg-white" style="min-height:150px;">
        <em class="text-muted">La r√©ponse IA appara√Ætra ici‚Ä¶</em>
      </div>
    </div>
  </div>

  <!-- JS de la page -->
  <script src="/js/epd.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide && window.lucide.createIcons) window.lucide.createIcons();
    });
  </script>
</body>
</html>
